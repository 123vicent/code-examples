name: CI

on: [push]

jobs:

  build:

    runs-on: ubuntu-latest
    strategy:
      matrix:
        # The MODULE environment variable is evaluated in build-all.sh to run a subset
        # of the builds. This way, multiple modules can be built in parallel.
        module: [ "module1", "module2", "module3", "module4" ]

    steps:

    - name: "Checkout sources"
      uses: actions/checkout@v1

    - name: "Setup Java"
      uses: actions/setup-java@v1
      env:
        # We don't actually need AWS credentials in the tests, but LocalStack
        # complains if they're not there, so we add dummies to the environment.
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_KEY: ${{ secrets.AWS_SECRET_KEY }}
        AWS_REGION: ${{ secrets.AWSREGION }}
      with:
        java-version: 13

    - name: "Build module ${{ matrix.module }}"
      with:
        MODULE: ${{ matrix.module }}
      run: |
        chmod 755 build-all.sh && ./build-all.sh
